<!DOCTYPE html>
<html lang="ko-KR">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>나만의 메모장</title>
    <script src="https://kit.fontawesome.com/6e1a70c9a1.js" crossorigin="anonymous"></script>
</head>

<body>
    <main>
        <h1>MEMO</h1>
        <button type="button" class="btn-add" onclick="addMemo()"><i
                class="fas fa-sharp fa-light fa-circle-plus fa-2x"></i></button>
        <div class="container">
            <!-- 메모지 입력 -->
            <!-- <article class="memo">
                <input type="text" id="title" placeholder="제목을 입력하세요">
                <textarea name="" id="content" cols="32" rows="13"></textarea>
                <button type="button" class="btn-save" onclick="saveMemo()">메모 등록</button>
            </article> -->
            <!-- 저장된 메모지 -->
            <!-- <article class="memo">
                <h2>title</h2>
                <p>Lorem ipsum dolor sit amet.</p>
                <button type="button" class="btn-delete" onclick="">삭제</button>
            </article> -->
            <!-- <article id="display"></article> -->
        </div>
    </main>
    <script>
        /**
         * TODO : 등록한 메모지 스타일 꾸미기
         * TODO : 메모지 추가하기 기능
         * TODO : 메모가 삭제된 경우 1.아무것도 없으면 빈 컨테이너 2.남은 메모지만 보이게
        */
        let allMemo = JSON.parse(localStorage.getItem("allMemo"));
        const container = document.querySelector(".container");
        const savedMemo = document.createElement("article");
        savedMemo.classList.add("saved-memo");

        allMemo = allMemo ?? [];
        // render();
        savedRender(); // 저장된 메모 불러오기

        // 저장된 메모 불러오기
        function savedRender() {
            container.appendChild(savedMemo);
            for (const item of allMemo) {
                const saveTitle = document.createElement("h2");
                const saveContent = document.createElement("p");
                const deleteBtn = document.createElement("button");
                saveTitle.textContent = item.title;
                saveTitle.classList.add("title-memo");

                saveContent.textContent = item.content;
                saveContent.classList.add("content-memo");

                deleteBtn.textContent = "삭제";
                deleteBtn.setAttribute("id", item.len);
                deleteBtn.setAttribute("onclick", "remove()");

                savedMemo.appendChild(saveTitle);
                savedMemo.appendChild(saveContent);
                savedMemo.appendChild(deleteBtn);
            }

        }

        // plus 버튼을 누르면 메모지 입력 양식 추가
        function addMemo() {
            const memo = document.createElement("article");
            container.appendChild(memo);

            const title = document.createElement("input");
            const content = document.createElement("textarea");
            const saveBtn = document.createElement("button");

            memo.classList.add("memo");
            title.type = "text";
            title.id = "title-input";
            title.placeholder = "제목을 입력하세요";

            content.id = "content-input";
            content.cols = "32";
            content.rows = "13";

            saveBtn.type = "button";
            saveBtn.classList.add("btn-save");
            saveBtn.onclick = saveMemo;
            saveBtn.textContent = "메모 저장"

            memo.append(title, content, saveBtn)
        }

        const title = document.getElementById("title");
        const content = document.getElementById("content");
        const saveBtn = document.querySelector(".btn-save");
        const memo = document.querySelector(".memo");

        // 메모 내용 로컬 스토리지에 저장하기
        function saveMemo() {
            const title = document.getElementById("title-input").value;
            const content = document.getElementById("content-input").value;

            allMemo.push({ title, content, len: allMemo.length });

            localStorage.setItem("allMemo", JSON.stringify(allMemo));
            render();
        }

        //입력폼에서 저장 후 저장된 메모 불러오기
        function render() {
            const memo = document.querySelector(".memo");

            memo.innerHTML = "";

            for (const item of allMemo) {

                const saveTitle = document.createElement("h2");
                const saveContent = document.createElement("p");
                // const saveId = document.createElement("p");
                const deleteBtn = document.createElement("button");

                saveTitle.textContent = item.title;
                saveTitle.classList.add("title-memo");

                saveContent.textContent = item.content;
                saveContent.classList.add("content-memo");

                // saveId.textContent = item.len + 1;
                deleteBtn.textContent = "삭제";
                deleteBtn.setAttribute("id", item.len);
                deleteBtn.setAttribute("onclick", "remove()");

                // memo.appendChild(saveId);
                memo.appendChild(saveTitle);
                memo.appendChild(saveContent);
                memo.appendChild(deleteBtn);
            }
        }
        // 메모 삭제
        function remove() {
            const idx = allMemo.find(item => item.len == event.srcElement.id);
            if (idx) {
                allMemo.splice(allMemo.findIndex(item => item.len == idx.len), 1);
            }
            localStorage.setItem("allMemo", JSON.stringify(allMemo));
            render();
        }

    </script>
</body>

</html>